{% extends "partials/base.html" %}
{% load humanize %}
{% load static %}
{% block content  %}

    <main class="main">

        <!-- Page Title -->
        <div class="page-title">
            <div class="heading">
            <div class="container">
                <div class="row d-flex justify-content-center text-center">
                <div class="col-lg-8">
                    <h1 class="heading-title">{{apartment.name}}</h1>
                    <p class="mb-0">
                    Listed by <strong>{{apartment.agent.full_name}}</strong>
                    </p>
                </div>
                </div>
            </div>
            </div>
            <nav class="breadcrumbs">
            <div class="container">
                <ol>
                <li><a href="index.html">Home</a></li>
                <li class="current">Property Details</li>
                </ol>
            </div>
            </nav>
        </div><!-- End Page Title -->

        <!-- Property Details Section -->
        <section id="property-details" class="property-details section">

            <div class="container" data-aos="fade-up" data-aos-delay="100">

            <div class="row gy-4">

                <div class="col-lg-8">
                    <div class="property-gallery" data-aos="fade-up" data-aos-delay="200">
                        <!-- MAIN IMAGE -->
                        <div class="main-image-container">
                            <img id="main-house-image" src="{{ apartment.image.url }}" alt="Property Image" class="img-fluid main-property-image">
                        </div>
                        <!-- THUMBNAILS -->
                        <div class="thumbnail-gallery thumbnail-list">
                            <div class="thumbnail-item" data-image="{{ apartment.image.url }}">
                                <img src="{{ apartment.image.url }}" alt="Property Image" class="img-fluid">
                            </div>
                            {% for g in apartment.apartment_gallery.all %}
                                <div class="thumbnail-item" data-image="{{ g.image.url }}">
                                    <img src="{{ g.image.url }}" alt="Property Image" class="img-fluid">
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    

                    <script>
                        document.querySelectorAll('.thumbnail-item').forEach(item => {
                            item.addEventListener('click', () => {
                                const imageUrl = item.getAttribute('data-image');
                                document.getElementById('main-house-image').src = imageUrl;
                            });
                        });
                    </script>
                    <!-- End Property Gallery -->

                    <!-- Property Description -->
                    <div class="property-description" data-aos="fade-up" data-aos-delay="300">
                        <h3>About This Property</h3>
                        <p>{{apartment.desc}}</p>
                        
                    </div><!-- End Property Description -->

                    <!-- Amenities -->
                    <div class="property-amenities" data-aos="fade-up" data-aos-delay="400">
                        <h3>Amenities &amp; Features</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Interior Features</h4>
                                <ul class="features-list">
                                    {% for i in apartment.apartment_interior.all %}
                                        <li><i class="bi bi-check-circle"></i>{{i.name}}</li>
                                    {% endfor %}                            
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h4>Exterior Features</h4>
                                <ul class="features-list">
                                    {% for e in apartment.apartment_exterior.all %}
                                        <li><i class="bi bi-check-circle"></i>{{e.name}}</li>
                                    {% endfor %}
                                
                                </ul>
                            </div>
                        </div>
                    </div><!-- End Amenities -->

                    <!-- Map Section -->
                    <div class="property-map" data-aos="fade-up" data-aos-delay="500">
                        <div class="location-details">
                            <h4>Neighborhood Information</h4>
                            <p>{{apartment.neigbourhood_info}}</p>
                        </div>
                    </div><!-- End Map Section -->

                </div>

                <div class="col-lg-4">

                <!-- Property Overview -->
                <div class="property-overview sticky-top" data-aos="fade-up" data-aos-delay="200">
                    <div class="price-tag">${{apartment.price|floatformat:0|intcomma}}</div>
                    <div class="property-status">For Sale</div>

                    <div class="property-address">
                    <h4>{{apartment.state}}, {{apartment.city}}</h4>
                    <p>{{apartment.address}}</p>
                    </div>

                    <div class="property-stats">
                    <div class="stat-item">
                        <i class="fas fa-bed bed-icon"></i>
                        <div>
                        <span class="value">{{apartment.bedrooms}}</span>
                        <span class="label">Bedrooms</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-bath"></i>
                        <div>
                        <span class="value">{{apartment.bathrooms}}</span>
                        <span class="label">Bathrooms</span>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <i class="fas fa-calendar"></i>
                        <div>
                        <span class="value">{{apartment.year_build}}</span>
                        <span class="label">Year Built</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-car"></i>
                        <div>
                        <span class="value">{{apartment.garage}}</span>
                        <span class="label">Garage</span>
                        </div>
                    </div>
                    </div>

                    <!-- Agent Info -->
                    <div class="agent-info">
                    <div class="agent-avatar">
                        <a href="{% url 'agent:agent_details' apartment.agent.agent_id %}"><img src="{{apartment.agent.image.url}}" alt="Sarah Johnson" class="img-fluid"></a>
                        
                    </div>
                    <div class="agent-details">
                        <a href="{% url 'agent:agent_details' apartment.agent.agent_id %}"><h4>{{apartment.agent.full_name}}</h4></a>
                        <div style="margin-top: -5px;">
                            {% for i in "12345" %}
                                <i class="fas fa-star {% if agent.agent_average_rating >= forloop.counter %}text-warning{% endif %}" style="font-size: 10px;"></i>
                            {% endfor %}
                        </div>
                        <p class="agent-title">Licensed {{apartment.agent.agent_type}}</p>
                        <p class="agent-phone"><i class="bi bi-telephone"></i>{{apartment.agent.phone}}</p>
                        <p class="agent-email"><i class="bi bi-envelope"></i>{{apartment.agent.email}}</p>
                    </div>
                    </div><!-- End Agent Info -->

                    <!-- Contact Form -->
                    <div class="contact-form">
                        <h4>Book Apartment</h4>
        
                        <form action="{% url 'core:check_apartment_availability' %}" class="" method="POST"> {% csrf_token %}
                            <div class="row">

                                <input type="hidden" name="apartment-id" class="text-danger" value="{{apartment.id}}" >
                                

                                <div class="col-12 form-group">
                                    <input type="text" name="full-name" class="form-control" placeholder="Your Name" required="">
                                </div>

                                <div class="col-12 form-group">
                                    <input type="email" name="email" class="form-control" placeholder="Your Email" required="">
                                </div>

                                <div class="col-12 form-group">
                                    <input type="tel" name="phone" class="form-control" placeholder="Your Phone">
                                </div>

                                <div class="col-12 form-group">
                                    <label for="">Check in</label><br>
                                    <input type="date" name="check-in" class="form-control checkin_date mt-1" placeholder="Select Check in date">
                                </div>

                                <div class="col-12 form-group">
                                    <label for="">Check out</label><br>
                                    <input type="date" name="check-out" class="form-control checkin_date mt-1" placeholder="Select Check out date">
                                </div>

                                

                                
                                <div class="col-12 text-center">
                                    <button type="submit" class="btn btn-primary">Proceed to payment</button>
                                </div>
                            </div>

                        </form> 

                        <script>
                            const today = new Date()
                            console.log(today);
                            const formattedToday = today.toISOString().split('T')[0];
                            console.log(formattedToday);
                            document.querySelector('.checkin_date').min = formattedToday;
                            document.querySelector('.checkout_date').min = formattedToday;

                        </script>
                       
                    
                    </div>
                <!-- End Contact Form -->

                    <!-- Social Share -->
                    <!-- <div class="social-share">
                        <h5>Share This Property</h5>
                        <div class="share-buttons">
                            <a href="#" class="share-btn facebook"><i class="bi bi-facebook"></i></a>
                            <a href="#" class="share-btn twitter"><i class="bi bi-twitter"></i></a>
                            <a href="#" class="share-btn whatsapp"><i class="bi bi-whatsapp"></i></a>
                            <a href="#" class="share-btn email"><i class="bi bi-envelope"></i></a>
                            <a href="#" class="share-btn print"><i class="bi bi-printer"></i></a>
                        </div>
                    </div> -->
                    <!-- End Social Share -->

                </div><!-- End Property Overview -->

                </div>

            </div>

            </div>

        </section><!-- /Property Details Section -->
        

        <!-- Blog Comments Section -->
        <section id="blog-comments" class="blog-comments section">
            <div class="container" data-aos="fade-up" data-aos-delay="100">
                <div class="blog-comments-4">
                    <div class="comments-header">
                        <h3 class="title">Apartment Rating (<i class="fas fa-star" style="color: gold; font-size: 25px;" ></i> {{apartment_rating|floatformat:1|default:0}})</h3>
                        <div class="comments-stats">
                            <span class="count" id="comment-count">{{reviews.count}}</span>
                            <span class="label">Comments</span>
                        </div>
                    </div>

                    <div class="comments-container" id="reviews-container">
                        <!-- Comment #1 -->
                        {% for r in reviews %}
                            <div class="comment-thread">
                                <div class="comment-box">
                                    <div class="comment-wrapper">
                                        <div class="avatar-wrapper">
                                            {% if r.user.profile.image %}
                                                <img src="{{r.user.profile.image.url}}" alt="Avatar" loading="lazy" />
                                            {% else %}
                                                 <img src="{% static 'assets/img/person/default.jpg' %}" alt="Avatar" loading="lazy" />
                                            {% endif %}
                                            
                                            <span class="status-indicator"></span>
                                        </div>

                                        <div class="comment-content">
                                            <div class="comment-header">
                                                <div class="user-info">
                                                    <h4>{{r.user.profile.full_name}}</h4>
                                                    <span class="time-badge mt-2 mb-2">
                                                        {% for i in "12345" %}
                                                            <i class="fas fa-star" {% if r.rating >= forloop.counter %}style="color: gold;"{% endif %}></i>
                                                        {% endfor %}
                                                    </span>

                                                    <span class="time-badge">
                                                        <i class="bi bi-clock"></i>
                                                        {{r.date}}
                                                    </span>
                                                </div>
                                                
                                            </div>

                                            <div class="comment-body">
                                                <p>{{r.review}}</p>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                                
                            </div>
                        {% endfor %}

                       
                    </div>
                </div>
            </div>
        </section>
        <!-- /Blog Comments Section -->


        <!-- Blog Comment Form Section -->
        <section id="blog-comment-form" class="blog-comment-form section">
            <div class="container" data-aos="fade-up" data-aos-delay="100">
                {% if review_exist %}
                    <input type="hidden">
                {% else %}
                    <form method="POST" action="{% url 'core:add_comment' apartment.apt_id %}" role="form" id="apartment-review-form"> {% csrf_token %}
                        <div class="form-header">
                            <h3>Leave a Review</h3>
                            <p>Your email address will not be published.</p>
                        </div>


                            <div class="col-12">
                                <div class="input-group">
                                    <label for="comment">Your Comment *</label>
                                    <textarea name="comment" id="comment" rows="5" placeholder="Write your thoughts here..." required=""></textarea>
                                    
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-group">
                                    <label>Rating *</label>  <br>
                                    <select name="rating" id="rating" class="form-control mt-1 mb-3" required>
                                        <option value="1">★☆☆☆☆</option>
                                        <option value="2">★★☆☆☆</option>
                                        <option value="3">★★★☆☆</option>
                                        <option value="4">★★★★☆</option>
                                        <option value="5">★★★★★</option>
                                    </select>
                                    
                                </div>
                            </div>


                            <div class="col-12 text-center">
                                <button type="submit">Post Comment</button>
                            </div>
                    
                    </form>
                {% endif %}
                
            </div>
        </section>
        <!-- /Blog Comment Form Section -->


    </main>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
        <!-- <script src="{% static 'assets/js/function.js' %}"></script> -->
    
    <script>
        // Debug jQuery and function.js loading
        console.log('apt_details.html loaded');
        console.log('jQuery loaded:', typeof jQuery !== 'undefined' ? jQuery.fn.jquery : 'not loaded');
    </script>

   
{% endblock %}

